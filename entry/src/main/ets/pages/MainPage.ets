import { HomeView } from '../view/HomeView';
import { MineView } from '../view/MineView';
import { CartView } from '../view/CartView';

@Entry
@Component
struct MainPage {
  @State currentIndex: number = 0;
  // [æ–°å¢] ç”¨äºé€šçŸ¥å­ç»„ä»¶åˆ·æ–°çš„ä¿¡å·
  @State refreshSignal: number = 0;

  @StorageLink('topRectHeight') topRectHeight: number = 0;
  @StorageLink('bottomRectHeight') bottomRectHeight: number = 0;

  // [æ–°å¢] é¡µé¢æ˜¾ç¤ºæ—¶ï¼ˆä»è¯¦æƒ…é¡µè¿”å›ï¼‰ï¼Œå¼ºåˆ¶åˆ·æ–°ä¿¡å·
  onPageShow() {
    this.refreshSignal++;
  }

  @Builder TabBuilder(title: string, index: number, iconStr: string) {
    Column() {
      Text(iconStr).fontSize(24).fontColor(this.currentIndex === index ? '#FF5000' : '#999999').margin({bottom: 2})
      Text(title).fontSize(10).fontColor(this.currentIndex === index ? '#FF5000' : '#999999')
    }
    .justifyContent(FlexAlign.Center).height('100%').width('100%')
  }

  build() {
    Tabs({ barPosition: BarPosition.End, index: this.currentIndex }) {
      TabContent() {
        HomeView()
      }.tabBar(this.TabBuilder("é¦–é¡µ", 0, "ğŸ "))

      TabContent() {
        // [ä¿®æ”¹] ä¼ é€’åˆ·æ–°ä¿¡å·ç»™ CartView
        CartView({ refreshTrigger: this.refreshSignal })
      }.tabBar(this.TabBuilder("è´­ç‰©è½¦", 1, "ğŸ›’"))

      TabContent() {
        MineView()
      }.tabBar(this.TabBuilder("æˆ‘çš„", 2, "ğŸ‘¤"))
    }
    .onChange((index) => {
      this.currentIndex = index;
      // [æ–°å¢] åˆ‡æ¢ Tab æ—¶ï¼Œä¹Ÿæ›´æ–°ä¿¡å·ï¼Œç¡®ä¿åˆ‡è¿‡å»çœ‹åˆ°æœ€æ–°çš„
      this.refreshSignal++;
    })
    .barMode(BarMode.Fixed)
    .barHeight(56 + this.getUIContext().px2vp(this.bottomRectHeight))
    .backgroundColor(Color.White)
    .scrollable(false)
  }
}