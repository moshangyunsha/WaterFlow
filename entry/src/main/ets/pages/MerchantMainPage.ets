import { MerchantProductView } from '../view/MerchantManageView';
import { MineView } from '../view/MineView';

@Entry
@Component
struct MerchantMainPage {
  @State currentIndex: number = 0;
  // [æ–°å¢ž]
  @State refreshSignal: number = 0;

  @StorageLink('bottomRectHeight') bottomRectHeight: number = 0;

  // [æ–°å¢ž] æ¯æ¬¡é¡µé¢æ˜¾ç¤ºï¼ˆæ¯”å¦‚å‘å¸ƒå•†å“å›žæ¥ï¼‰éƒ½è§¦å‘
  onPageShow() {
    this.refreshSignal++;
  }

  @Builder TabBuilder(title: string, index: number, iconStr: string) {
    Column() {
      Text(iconStr).fontSize(24).fontColor(this.currentIndex === index ? '#007DFF' : '#999999').margin({bottom: 2})
      Text(title).fontSize(10).fontColor(this.currentIndex === index ? '#007DFF' : '#999999')
    }
    .justifyContent(FlexAlign.Center).height('100%').width('100%')
  }

  build() {
    Tabs({ barPosition: BarPosition.End, index: this.currentIndex }) {
      TabContent() {
        // [ä¿®æ”¹] ä¼ å…¥ä¿¡å·
        MerchantProductView({ refreshTrigger: this.refreshSignal })
      }.tabBar(this.TabBuilder("å•†å“ç®¡ç†", 0, "ðŸ“¦"))

      TabContent() {
        MineView()
      }.tabBar(this.TabBuilder("æˆ‘çš„åº—é“º", 1, "ðŸª"))
    }
    .onChange((index) => {
      this.currentIndex = index;
      this.refreshSignal++; // åˆ‡ Tab ä¹Ÿåˆ·æ–°
    })
    .barHeight(56 + this.getUIContext().px2vp(this.bottomRectHeight))
    .backgroundColor(Color.White)
    .scrollable(false)
  }
}